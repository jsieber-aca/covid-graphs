<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>

  </head>
  <body>
    <div class="chart-container-top-countries" style="position: relative; height:120vh; width:90vw">
        <canvas id="myChart"></canvas>
    </div>
    <div class="chart-container-Montana" style="position: relative; height:120vh; width:90vw">
      <canvas id="myChartMontana"></canvas>
    </div>
<script>

/*
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        datasets: [{
            label: '# of Votes',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
*/
</script>


      <script>
        <!-- historical data -->
        d3.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv").then(function(data) {
        //  console.log(data); // [{"Hello": "world"}, â€¦]
        });

        const numberofconfirmed = 50000;
        const proxyurl = "https://cors-anywhere.herokuapp.com/";
        const url = "https://www.trackcorona.live/api/countries/";
        fetch(proxyurl + url)
        //fetch('https://www.trackcorona.live/api/countries/')
          .then((response) => {
            if (response.status !== 200) {
              console.log('Looks like there was a problem. Status Code: ' +
                response.status);
              return;
            }
            return response.json();
          })
          .then((cdata) => {
            var countries = cdata.data.filter(function (data){
              return data.confirmed > numberofconfirmed;
            }).map(function (data){
              return data.location;
            });
            var confirmed = cdata.data.filter(function (data){
                return data.confirmed > numberofconfirmed;
            }).map(function (data){
              return data.confirmed;
            });

            /*
            var countries = function (obj) {
                //sort results
                var sortable = [];
                for (var country in countries) {
                    sortable.push([country, countries[country]]);
                }

                sortable.sort(function(a, b) {
                    return a[1] - b[1];
                });

                var countriesSorted = {}
                sortable.forEach(function(item){
                    countriesSorted[item[0]]=item[1]
                })
              };

              var confirmed = function (obj) {
                  //sort results
                  var sortable = [];
                  for (var country in countries) {
                      sortable.push([country, countries[country]]);
                  }

                  sortable.sort(function(a, b) {
                      return a[1] - b[1];
                  });
                  var confirmedSorted = {}
                  sortable.forEach(function(item){
                      confirmedSorted[item[0]]=item[1]
                  })
                };
            */
            //console.log(countriesSorted);
            //console.log(confirmed);
            //console.log(cdata);
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: countries,
                    datasets: [{
                        label: '# of confirmed cases',
                        data: confirmed,
                        backgroundColor: randomColorGenerator(countries.length),
                        borderColor: randomColorGenerator(countries.length),
                        highlightFill: randomColorGenerator(countries.length),
                        highlightStroke: randomColorGenerator(countries.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true

                            }
                        }]
                    }
                }
            });

          });


          //Montana datasets

          //const proxyurl = "https://cors-anywhere.herokuapp.com/";
          const murl = "https://www.trackcorona.live/api/cities/";
          fetch(proxyurl + murl)
          //fetch('https://www.trackcorona.live/api/countries/')
            .then((response) => {
              if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                  response.status);
                return;
              }
              return response.json();
            })
            .then((mdata) => {
              var counties = mdata.data.filter(function (data){
                return data.location.substr(-7) === "Montana";
              }).map(function (data){
                return data.location.slice(0, -15);;
              });
              var cconfirmed = mdata.data.filter(function (data){
                  return data.location.substr(-7) === "Montana";
              }).map(function (data){
                return data.confirmed;
              });
              //console.log(counties);
              //console.log(cconfirmed);
              //console.log(mdata);
              var ctx = document.getElementById('myChartMontana').getContext('2d');
              var myChart = new Chart(ctx, {
                  type: 'bar',
                  data: {
                      labels: counties,
                      datasets: [{
                          label: '# of confirmed cases',
                          data: cconfirmed,
                          backgroundColor: randomColorGenerator(counties.length),
                          borderColor: randomColorGenerator(counties.length),
                          highlightFill: randomColorGenerator(counties.length),
                          highlightStroke: randomColorGenerator(counties.length),
                          borderWidth: 1
                      }]
                  },
                  options: {
                      scales: {
                          yAxes: [{
                              ticks: {
                                  beginAtZero: true

                              }
                          }]
                      }
                  }
              });

            });

            var objSort = function (obj) {
                //sort results
                var sortable = [];
                for (var country in countries) {
                    sortable.push([country, countries[country]]);
                }

                sortable.sort(function(a, b) {
                    return a[1] - b[1];
                });
                var objSorted = {}
                sortable.forEach(function(item){
                    objSorted[item[0]]=item[1]
                })
              };

              var randomColorGenerator = function (l) {
                //console.log(l);
                var colorArray = [];
                for (i = 0; i < l; i++) {
                  colorArray.push('#' + (Math.random().toString(16) + '0000000').slice(2, 8));
                }
                return colorArray;
              };
      </script>
  </body>
</html>
